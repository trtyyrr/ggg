<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8"><title>Valae Magisk Factory</title>
    <style>
        :root { --neon: #ff003c; --bg: #0d0d0d; } /* æ¢æˆçƒ­è¡€çš„çº¢è‰² */
        body { background: var(--bg); color: var(--neon); font-family: monospace; padding: 20px; }
        .factory-card { max-width: 850px; margin: 0 auto; border: 2px solid var(--neon); padding: 30px; box-shadow: 0 0 20px var(--neon); }
        textarea { width: 100%; height: 150px; background: #000; color: #fff; border: 1px solid var(--neon); padding: 15px; margin: 20px 0; }
        button { background: var(--neon); color: #fff; border: none; width: 100%; padding: 20px; font-weight: bold; cursor: pointer; }
        #console { background: #000; border: 1px solid #333; height: 200px; overflow-y: auto; padding: 15px; margin-top: 20px; color: #888; font-size: 12px; }
    </style>
</head>
<body>

<div class="factory-card">
    <h1>ğŸ”¥ VALAE MAGISK FACTORY</h1>
    <p>è¾“å…¥æ¨¡å—åŠŸèƒ½æè¿°ï¼ˆå¦‚ï¼šä¿®æ”¹ç³»ç»Ÿ DPIã€éšè—åº”ç”¨ã€ä¼˜åŒ–ç”µæ± ï¼‰</p>
    <textarea id="prompt" placeholder="ç¤ºä¾‹ï¼šåšä¸€ä¸ªä¿®æ”¹ç³»ç»Ÿå­—ä½“ä¸ºæ€æºé»‘ä½“çš„æ¨¡å—ã€‚"></textarea>
    <button onclick="ignite()">ä¸€é”®åˆæˆ Magisk æ¨¡å—</button>
    <div id="console">READY_TO_ROOT...</div>
</div>

<script>
    const DS_KEY = "sk-ä½ çš„Key"; 
    const GH_TOKEN = "ghp_ä½ çš„Token"; 
    const REPO = "ç”¨æˆ·å/ä»“åº“å"; 

    const SYSTEM_PROMPT = `ä½ æ˜¯ä¸€ä¸ª Magisk æ¨¡å—å¼€å‘ä¸“å®¶ã€‚
    è¯·æ ¹æ®éœ€æ±‚è¾“å‡º JSON æ ¼å¼çš„æ–‡ä»¶åˆ—è¡¨ï¼Œå¿…é¡»åŒ…å«ï¼š
    1. module.prop (åŒ…å« id, name, version, versionCode, author, description)
    2. service.sh (æ‰§è¡ŒåŠŸèƒ½çš„è„šæœ¬)
    3. install.sh (å®‰è£…è„šæœ¬)
    4. å¿…è¦çš„ system æ–‡ä»¶å¤¹è·¯å¾„ã€‚
    æ ¼å¼ï¼š{"files": [{"path": "module.prop", "content": "..."}, {"path": "service.sh", "content": "..."}]}`;

    async function log(msg, color) {
        const c = document.getElementById('console');
        c.innerHTML += `<div style="color:${color}">> ${msg}</div>`;
        c.scrollTop = c.scrollHeight;
    }

    async function ignite() {
        const prompt = document.getElementById('prompt').value;
        if(!prompt) return;
        document.getElementById('console').innerHTML = "";
        log("AI æ­£åœ¨æ„å»ºæ¨¡å—ä»£ç ...", "yellow");

        try {
            const res = await fetch('https://api.deepseek.com/chat/completions', {
                method: 'POST',
                headers: {'Content-Type': 'application/json', 'Authorization': `Bearer ${DS_KEY}`},
                body: JSON.stringify({
                    model: "deepseek-chat",
                    messages: [{role: "system", content: SYSTEM_PROMPT}, {role: "user", content: prompt}],
                    response_format: { type: 'json_object' }
                })
            });

            const data = await res.json();
            const files = JSON.parse(data.choices[0].message.content).files;

            for (const file of files) {
                log(`æ­£åœ¨æ³¨å…¥: ${file.path}`, "gray");
                const ghUrl = `https://api.github.com/repos/${REPO}/contents/${file.path}`;
                let sha = "";
                const check = await fetch(ghUrl, { headers: {'Authorization': `token ${GH_TOKEN}`} });
                if(check.ok) { const meta = await check.json(); sha = meta.sha; }

                await fetch(ghUrl, {
                    method: 'PUT',
                    headers: {'Authorization': `token ${GH_TOKEN}`, 'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        message: `Magisk Build: ${file.path}`,
                        content: btoa(unescape(encodeURIComponent(file.content))),
                        sha: sha || undefined
                    })
                });
            }
            log("âœ¨ æ¨¡å—æºç å·²æ¨é€åˆ° GitHubï¼æ­£åœ¨è‡ªåŠ¨æ‰“åŒ… ZIP...", "#00ff41");
        } catch (e) { log("é”™è¯¯: " + e.message, "red"); }
    }
</script>
</body>
</html>