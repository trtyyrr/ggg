<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"><title>Valae Android Factory</title>
    <style>
        body { background: #0a0a0a; color: #00ff41; font-family: 'Courier New', monospace; padding: 20px; line-height: 1.5; }
        .container { max-width: 850px; margin: 0 auto; border: 1px solid #00ff41; padding: 30px; box-shadow: 0 0 20px rgba(0,255,65,0.2); }
        textarea { width: 100%; height: 150px; background: #000; color: #00ff41; border: 1px solid #00ff41; padding: 10px; font-size: 1.1em; margin: 20px 0; outline: none; }
        button { background: #00ff41; color: #000; border: none; padding: 15px 30px; cursor: pointer; font-weight: bold; width: 100%; font-size: 1.2em; text-transform: uppercase; }
        button:hover { background: #008f11; }
        #log { margin-top: 25px; border-top: 1px dashed #00ff41; padding-top: 15px; font-size: 0.9em; height: 200px; overflow-y: auto; }
        .success { color: #fff; font-weight: bold; }
        .cmd { color: #888; }
    </style>
</head>
<body>
    <div class="container">
        <h2>ğŸ›°ï¸ VALAE: CLOUD APK FACTORY</h2>
        <div class="cmd">SYSTEM STATUS: READY_TO_BUILD</div>
        <textarea id="prompt" placeholder="åœ¨æ­¤è¾“å…¥ä½ çš„APPåˆ›æ„ï¼Œä¾‹å¦‚ï¼šåˆ¶ä½œä¸€ä¸ªç®€å•çš„è®¡ç®—å™¨ï¼ŒèƒŒæ™¯æ˜¯æ·±ç°è‰²çš„ã€‚"></textarea>
        <button onclick="startBuild()">å¯åŠ¨å…¨è‡ªåŠ¨åŒ–æµæ°´çº¿</button>
        <div id="log">ç­‰å¾…æŒ‡ä»¤è¾“å…¥...</div>
    </div>

    <script>
        // ğŸ”‘ é‡è¦ï¼šå¦‚æœä½ ç”¨äº† Vercel ç¯å¢ƒå˜é‡ï¼Œè¯·ç¡®ä¿åå­—å¯¹åº”ã€‚å¦‚æœç›´æ¥å¡«ï¼Œè¯·æ‹†åˆ†å­—ç¬¦ä¸²é¿å…æ‹¦æˆªã€‚
        const DS_KEY = "ä½ çš„DEEPSEEKå¯†é’¥"; 
        const GH_TOKEN = "ä½ çš„GITHUBå¯†é’¥"; 
        const REPO = "ä½ çš„ç”¨æˆ·å/ä»“åº“å"; 

        const SYSTEM_PROMPT = `ä½ æ˜¯ä¸€ä¸ªå®‰å“æ¶æ„å¸ˆã€‚è¾“å‡ºå¿…é¡»ä¸¥æ ¼ä¸º JSON æ ¼å¼ï¼ŒåŒ…å«ä»¥ä¸‹ 4 ä¸ªæ ‡å‡†æ–‡ä»¶ï¼š
        1. build.gradle (æ ¹ç›®å½•é…ç½®æ–‡ä»¶)
        2. app/build.gradle (APP æ¨¡å—é…ç½®)
        3. app/src/main/AndroidManifest.xml (ç³»ç»Ÿæ¸…å•)
        4. app/src/main/java/com/valae/ai/MainActivity.java (ä¸šåŠ¡é€»è¾‘)
        è¦æ±‚ï¼šåŒ…åç»Ÿä¸€ä½¿ç”¨ com.valae.aiï¼Œæ‰€æœ‰ä»£ç å†™åœ¨ MainActivity ä¸­ã€‚`;

        async function log(msg, isSuccess = false) {
            const l = document.getElementById('log');
            l.innerHTML += `<div class="${isSuccess?'success':''}">> ${msg}</div>`;
            l.scrollTop = l.scrollHeight;
        }

        async function startBuild() {
            const prompt = document.getElementById('prompt').value;
            if(!prompt) return;
            document.getElementById('log').innerHTML = ""; // æ¸…ç©ºæ—¥å¿—
            log("æ­£åœ¨åˆå§‹åŒ– AI å¼•æ“...");

            try {
                // 1. è°ƒç”¨ AI
                const aiRes = await fetch('https://api.deepseek.com/chat/completions', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json', 'Authorization': `Bearer ${DS_KEY}`},
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [{role: "system", content: SYSTEM_PROMPT}, {role: "user", content: prompt}],
                        response_format: { type: 'json_object' }
                    })
                });
                const aiData = await aiRes.json();
                const files = JSON.parse(aiData.choices[0].message.content).files;
                log("AI æ¶æ„è®¾è®¡å®Œæˆï¼Œå¼€å§‹åŒæ­¥è‡³ GitHub...", true);

                // 2. æ‰¹é‡æ¨é€è‡³ GitHub
                for (const file of files) {
                    log(`æ­£åœ¨å†™å…¥: ${file.path}`);
                    const ghUrl = `https://api.github.com/repos/${REPO}/contents/${file.path}`;
                    
                    let sha = "";
                    const getFile = await fetch(ghUrl, { headers: {'Authorization': `token ${GH_TOKEN}`} });
                    if(getFile.ok) { const fd = await getFile.json(); sha = fd.sha; }

                    const putRes = await fetch(ghUrl, {
                        method: 'PUT',
                        headers: {'Authorization': `token ${GH_TOKEN}`, 'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            message: `V-Factory Build: ${file.path}`,
                            content: btoa(unescape(encodeURIComponent(file.content))),
                            sha: sha || undefined
                        })
                    });
                    if(putRes.ok) log(`[OK] ${file.path} åŒæ­¥æˆåŠŸ`, true);
                }
                log("âœ¨ ä»»åŠ¡å…¨éƒ¨å®Œæˆï¼GitHub Actions å·²è‡ªåŠ¨å¯åŠ¨ï¼Œè¯·ç¨åä¸‹è½½ APKã€‚", true);
            } catch (e) { log("ğŸ’¥ è‡´å‘½é”™è¯¯: " + e.message); }
        }
    </script>
</body>
</html>